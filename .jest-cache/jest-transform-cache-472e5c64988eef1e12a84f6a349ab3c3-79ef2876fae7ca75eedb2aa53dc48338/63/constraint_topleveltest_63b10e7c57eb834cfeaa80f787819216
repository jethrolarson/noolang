07c7847add0f58a0af263448b3821729
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lexer_1 = require("../src/lexer");
const parser_1 = require("../src/parser/parser");
const decoration_1 = require("../src/typer/decoration");
describe("Top-level Constraint and Implement Definitions", () => {
    const runConstraintCode = (code) => {
        const lexer = new lexer_1.Lexer(code);
        const tokens = lexer.tokenize();
        const ast = (0, parser_1.parse)(tokens);
        const typedResult = (0, decoration_1.typeAndDecorate)(ast);
        return typedResult;
    };
    test("should parse constraint definition at top level", () => {
        const code = `constraint Show a ( show : a -> String )`;
        const result = runConstraintCode(code);
        expect(result.program.statements).toHaveLength(1);
        expect(result.program.statements[0].kind).toBe("constraint-definition");
        const constraintDef = result.program.statements[0];
        expect(constraintDef.name).toBe("Show");
        expect(constraintDef.typeParam).toBe("a");
        expect(constraintDef.functions).toHaveLength(1);
        expect(constraintDef.functions[0].name).toBe("show");
    });
    test("should parse implement definition at top level", () => {
        const code = `
      constraint Show a ( show : a -> String );
      implement Show Int ( show = toString )
    `;
        const result = runConstraintCode(code);
        expect(result.program.statements).toHaveLength(1);
        expect(result.program.statements[0].kind).toBe("binary");
        // Navigate the binary expression tree: constraint ; implement
        const binaryExpr = result.program.statements[0];
        expect(binaryExpr.operator).toBe(";");
        expect(binaryExpr.left.kind).toBe("constraint-definition");
        expect(binaryExpr.right.kind).toBe("implement-definition");
        const constraintDef = binaryExpr.left;
        expect(constraintDef.name).toBe("Show");
        const implementDef = binaryExpr.right;
        expect(implementDef.constraintName).toBe("Show");
        expect(implementDef.typeName).toBe("Int");
        expect(implementDef.implementations).toHaveLength(1);
        expect(implementDef.implementations[0].name).toBe("show");
    });
    test("should resolve constraint functions from implementations", () => {
        const code = `
      constraint Show a ( show : a -> String );
      implement Show Int ( show = toString );
      x = show 42
    `;
        const result = runConstraintCode(code);
        expect(result.program.statements).toHaveLength(1);
        expect(result.program.statements[0].kind).toBe("binary");
        // Navigate the binary expression tree: (constraint ; implement) ; definition
        const outerBinary = result.program.statements[0];
        expect(outerBinary.operator).toBe(";");
        expect(outerBinary.left.kind).toBe("binary"); // constraint ; implement
        expect(outerBinary.right.kind).toBe("definition"); // x = show 42
        const definition = outerBinary.right;
        expect(definition.name).toBe("x");
    });
    test("should support multiple constraint functions", () => {
        const code = `
      constraint Eq a ( 
        equals : a -> a -> Bool; 
        notEquals : a -> a -> Bool 
      );
      implement Eq Int ( 
        equals = fn a b => a == b;
        notEquals = fn a b => a != b
      );
      result = equals 1 2
    `;
        const result = runConstraintCode(code);
        expect(result.program.statements).toHaveLength(1);
        expect(result.program.statements[0].kind).toBe("binary");
        // Navigate the binary expression tree: (constraint ; implement) ; definition
        const outerBinary = result.program.statements[0];
        const innerBinary = outerBinary.left; // constraint ; implement
        const constraintDef = innerBinary.left;
        expect(constraintDef.kind).toBe("constraint-definition");
        expect(constraintDef.functions).toHaveLength(2);
        expect(constraintDef.functions[0].name).toBe("equals");
        expect(constraintDef.functions[1].name).toBe("notEquals");
        const implementDef = innerBinary.right;
        expect(implementDef.kind).toBe("implement-definition");
        expect(implementDef.implementations).toHaveLength(2);
        expect(implementDef.implementations[0].name).toBe("equals");
        expect(implementDef.implementations[1].name).toBe("notEquals");
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRTFELE1BQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxLQUFLLENBQUM7UUFDdkMsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztRQUN2RCxNQUFNLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRCxNQUFNLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDNUQsTUFBTSxDQUFDLFlBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2pFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL3dvcmtzcGFjZS90ZXN0L2NvbnN0cmFpbnRfdG9wbGV2ZWwudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMZXhlciB9IGZyb20gXCIuLi9zcmMvbGV4ZXJcIjtcbmltcG9ydCB7IHBhcnNlIH0gZnJvbSBcIi4uL3NyYy9wYXJzZXIvcGFyc2VyXCI7XG5pbXBvcnQgeyB0eXBlQW5kRGVjb3JhdGUgfSBmcm9tIFwiLi4vc3JjL3R5cGVyL2RlY29yYXRpb25cIjtcblxuZGVzY3JpYmUoXCJUb3AtbGV2ZWwgQ29uc3RyYWludCBhbmQgSW1wbGVtZW50IERlZmluaXRpb25zXCIsICgpID0+IHtcbiAgY29uc3QgcnVuQ29uc3RyYWludENvZGUgPSAoY29kZTogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgbGV4ZXIgPSBuZXcgTGV4ZXIoY29kZSk7XG4gICAgY29uc3QgdG9rZW5zID0gbGV4ZXIudG9rZW5pemUoKTtcbiAgICBjb25zdCBhc3QgPSBwYXJzZSh0b2tlbnMpO1xuICAgIGNvbnN0IHR5cGVkUmVzdWx0ID0gdHlwZUFuZERlY29yYXRlKGFzdCk7XG4gICAgcmV0dXJuIHR5cGVkUmVzdWx0O1xuICB9O1xuXG4gIHRlc3QoXCJzaG91bGQgcGFyc2UgY29uc3RyYWludCBkZWZpbml0aW9uIGF0IHRvcCBsZXZlbFwiLCAoKSA9PiB7XG4gICAgY29uc3QgY29kZSA9IGBjb25zdHJhaW50IFNob3cgYSAoIHNob3cgOiBhIC0+IFN0cmluZyApYDtcbiAgICBjb25zdCByZXN1bHQgPSBydW5Db25zdHJhaW50Q29kZShjb2RlKTtcbiAgICBcbiAgICBleHBlY3QocmVzdWx0LnByb2dyYW0uc3RhdGVtZW50cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgIGV4cGVjdChyZXN1bHQucHJvZ3JhbS5zdGF0ZW1lbnRzWzBdLmtpbmQpLnRvQmUoXCJjb25zdHJhaW50LWRlZmluaXRpb25cIik7XG4gICAgXG4gICAgY29uc3QgY29uc3RyYWludERlZiA9IHJlc3VsdC5wcm9ncmFtLnN0YXRlbWVudHNbMF0gYXMgYW55O1xuICAgIGV4cGVjdChjb25zdHJhaW50RGVmLm5hbWUpLnRvQmUoXCJTaG93XCIpO1xuICAgIGV4cGVjdChjb25zdHJhaW50RGVmLnR5cGVQYXJhbSkudG9CZShcImFcIik7XG4gICAgZXhwZWN0KGNvbnN0cmFpbnREZWYuZnVuY3Rpb25zKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgZXhwZWN0KGNvbnN0cmFpbnREZWYuZnVuY3Rpb25zWzBdLm5hbWUpLnRvQmUoXCJzaG93XCIpO1xuICB9KTtcblxuICB0ZXN0KFwic2hvdWxkIHBhcnNlIGltcGxlbWVudCBkZWZpbml0aW9uIGF0IHRvcCBsZXZlbFwiLCAoKSA9PiB7XG4gICAgY29uc3QgY29kZSA9IGBcbiAgICAgIGNvbnN0cmFpbnQgU2hvdyBhICggc2hvdyA6IGEgLT4gU3RyaW5nICk7XG4gICAgICBpbXBsZW1lbnQgU2hvdyBJbnQgKCBzaG93ID0gdG9TdHJpbmcgKVxuICAgIGA7XG4gICAgY29uc3QgcmVzdWx0ID0gcnVuQ29uc3RyYWludENvZGUoY29kZSk7XG4gICAgXG4gICAgZXhwZWN0KHJlc3VsdC5wcm9ncmFtLnN0YXRlbWVudHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICBleHBlY3QocmVzdWx0LnByb2dyYW0uc3RhdGVtZW50c1swXS5raW5kKS50b0JlKFwiYmluYXJ5XCIpO1xuICAgIFxuICAgIC8vIE5hdmlnYXRlIHRoZSBiaW5hcnkgZXhwcmVzc2lvbiB0cmVlOiBjb25zdHJhaW50IDsgaW1wbGVtZW50XG4gICAgY29uc3QgYmluYXJ5RXhwciA9IHJlc3VsdC5wcm9ncmFtLnN0YXRlbWVudHNbMF0gYXMgYW55O1xuICAgIGV4cGVjdChiaW5hcnlFeHByLm9wZXJhdG9yKS50b0JlKFwiO1wiKTtcbiAgICBleHBlY3QoYmluYXJ5RXhwci5sZWZ0LmtpbmQpLnRvQmUoXCJjb25zdHJhaW50LWRlZmluaXRpb25cIik7XG4gICAgZXhwZWN0KGJpbmFyeUV4cHIucmlnaHQua2luZCkudG9CZShcImltcGxlbWVudC1kZWZpbml0aW9uXCIpO1xuICAgIFxuICAgIGNvbnN0IGNvbnN0cmFpbnREZWYgPSBiaW5hcnlFeHByLmxlZnQ7XG4gICAgZXhwZWN0KGNvbnN0cmFpbnREZWYubmFtZSkudG9CZShcIlNob3dcIik7XG4gICAgXG4gICAgY29uc3QgaW1wbGVtZW50RGVmID0gYmluYXJ5RXhwci5yaWdodDtcbiAgICBleHBlY3QoaW1wbGVtZW50RGVmLmNvbnN0cmFpbnROYW1lKS50b0JlKFwiU2hvd1wiKTtcbiAgICBleHBlY3QoaW1wbGVtZW50RGVmLnR5cGVOYW1lKS50b0JlKFwiSW50XCIpO1xuICAgIGV4cGVjdChpbXBsZW1lbnREZWYuaW1wbGVtZW50YXRpb25zKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgZXhwZWN0KGltcGxlbWVudERlZi5pbXBsZW1lbnRhdGlvbnNbMF0ubmFtZSkudG9CZShcInNob3dcIik7XG4gIH0pO1xuXG4gIHRlc3QoXCJzaG91bGQgcmVzb2x2ZSBjb25zdHJhaW50IGZ1bmN0aW9ucyBmcm9tIGltcGxlbWVudGF0aW9uc1wiLCAoKSA9PiB7XG4gICAgY29uc3QgY29kZSA9IGBcbiAgICAgIGNvbnN0cmFpbnQgU2hvdyBhICggc2hvdyA6IGEgLT4gU3RyaW5nICk7XG4gICAgICBpbXBsZW1lbnQgU2hvdyBJbnQgKCBzaG93ID0gdG9TdHJpbmcgKTtcbiAgICAgIHggPSBzaG93IDQyXG4gICAgYDtcbiAgICBjb25zdCByZXN1bHQgPSBydW5Db25zdHJhaW50Q29kZShjb2RlKTtcbiAgICBcbiAgICBleHBlY3QocmVzdWx0LnByb2dyYW0uc3RhdGVtZW50cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgIGV4cGVjdChyZXN1bHQucHJvZ3JhbS5zdGF0ZW1lbnRzWzBdLmtpbmQpLnRvQmUoXCJiaW5hcnlcIik7XG4gICAgXG4gICAgLy8gTmF2aWdhdGUgdGhlIGJpbmFyeSBleHByZXNzaW9uIHRyZWU6IChjb25zdHJhaW50IDsgaW1wbGVtZW50KSA7IGRlZmluaXRpb25cbiAgICBjb25zdCBvdXRlckJpbmFyeSA9IHJlc3VsdC5wcm9ncmFtLnN0YXRlbWVudHNbMF0gYXMgYW55O1xuICAgIGV4cGVjdChvdXRlckJpbmFyeS5vcGVyYXRvcikudG9CZShcIjtcIik7XG4gICAgZXhwZWN0KG91dGVyQmluYXJ5LmxlZnQua2luZCkudG9CZShcImJpbmFyeVwiKTsgLy8gY29uc3RyYWludCA7IGltcGxlbWVudFxuICAgIGV4cGVjdChvdXRlckJpbmFyeS5yaWdodC5raW5kKS50b0JlKFwiZGVmaW5pdGlvblwiKTsgLy8geCA9IHNob3cgNDJcbiAgICBcbiAgICBjb25zdCBkZWZpbml0aW9uID0gb3V0ZXJCaW5hcnkucmlnaHQ7XG4gICAgZXhwZWN0KGRlZmluaXRpb24ubmFtZSkudG9CZShcInhcIik7XG4gIH0pO1xuXG4gIHRlc3QoXCJzaG91bGQgc3VwcG9ydCBtdWx0aXBsZSBjb25zdHJhaW50IGZ1bmN0aW9uc1wiLCAoKSA9PiB7XG4gICAgY29uc3QgY29kZSA9IGBcbiAgICAgIGNvbnN0cmFpbnQgRXEgYSAoIFxuICAgICAgICBlcXVhbHMgOiBhIC0+IGEgLT4gQm9vbDsgXG4gICAgICAgIG5vdEVxdWFscyA6IGEgLT4gYSAtPiBCb29sIFxuICAgICAgKTtcbiAgICAgIGltcGxlbWVudCBFcSBJbnQgKCBcbiAgICAgICAgZXF1YWxzID0gZm4gYSBiID0+IGEgPT0gYjtcbiAgICAgICAgbm90RXF1YWxzID0gZm4gYSBiID0+IGEgIT0gYlxuICAgICAgKTtcbiAgICAgIHJlc3VsdCA9IGVxdWFscyAxIDJcbiAgICBgO1xuICAgIGNvbnN0IHJlc3VsdCA9IHJ1bkNvbnN0cmFpbnRDb2RlKGNvZGUpO1xuICAgIFxuICAgIGV4cGVjdChyZXN1bHQucHJvZ3JhbS5zdGF0ZW1lbnRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgZXhwZWN0KHJlc3VsdC5wcm9ncmFtLnN0YXRlbWVudHNbMF0ua2luZCkudG9CZShcImJpbmFyeVwiKTtcbiAgICBcbiAgICAvLyBOYXZpZ2F0ZSB0aGUgYmluYXJ5IGV4cHJlc3Npb24gdHJlZTogKGNvbnN0cmFpbnQgOyBpbXBsZW1lbnQpIDsgZGVmaW5pdGlvblxuICAgIGNvbnN0IG91dGVyQmluYXJ5ID0gcmVzdWx0LnByb2dyYW0uc3RhdGVtZW50c1swXSBhcyBhbnk7XG4gICAgY29uc3QgaW5uZXJCaW5hcnkgPSBvdXRlckJpbmFyeS5sZWZ0OyAvLyBjb25zdHJhaW50IDsgaW1wbGVtZW50XG4gICAgXG4gICAgY29uc3QgY29uc3RyYWludERlZiA9IGlubmVyQmluYXJ5LmxlZnQ7XG4gICAgZXhwZWN0KGNvbnN0cmFpbnREZWYua2luZCkudG9CZShcImNvbnN0cmFpbnQtZGVmaW5pdGlvblwiKTtcbiAgICBleHBlY3QoY29uc3RyYWludERlZi5mdW5jdGlvbnMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICBleHBlY3QoY29uc3RyYWludERlZi5mdW5jdGlvbnNbMF0ubmFtZSkudG9CZShcImVxdWFsc1wiKTtcbiAgICBleHBlY3QoY29uc3RyYWludERlZi5mdW5jdGlvbnNbMV0ubmFtZSkudG9CZShcIm5vdEVxdWFsc1wiKTtcbiAgICBcbiAgICBjb25zdCBpbXBsZW1lbnREZWYgPSBpbm5lckJpbmFyeS5yaWdodDtcbiAgICBleHBlY3QoaW1wbGVtZW50RGVmLmtpbmQpLnRvQmUoXCJpbXBsZW1lbnQtZGVmaW5pdGlvblwiKTtcbiAgICBleHBlY3QoaW1wbGVtZW50RGVmLmltcGxlbWVudGF0aW9ucykudG9IYXZlTGVuZ3RoKDIpO1xuICAgIGV4cGVjdChpbXBsZW1lbnREZWYuaW1wbGVtZW50YXRpb25zWzBdLm5hbWUpLnRvQmUoXCJlcXVhbHNcIik7XG4gICAgZXhwZWN0KGltcGxlbWVudERlZi5pbXBsZW1lbnRhdGlvbnNbMV0ubmFtZSkudG9CZShcIm5vdEVxdWFsc1wiKTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=