491353e7b01ebdc8b1157aec421f3ef0
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const lexer_1 = require("../../lexer");
const parser_1 = require("../../parser/parser");
const __1 = require("..");
const helpers_1 = require("../helpers");
const __2 = require("..");
const builtins_1 = require("../builtins");
// Helper function to parse a string into a program
const parseProgram = (source) => {
    const lexer = new lexer_1.Lexer(source);
    const tokens = lexer.tokenize();
    return (0, parser_1.parse)(tokens);
};
(0, globals_1.describe)("Functional Type Inference", () => {
    (0, globals_1.describe)("Basic Types", () => {
        (0, globals_1.it)("should infer integer literal", () => {
            const program = parseProgram("42");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should infer string literal", () => {
            const program = parseProgram('"hello"');
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("String");
        });
        (0, globals_1.it)("should infer boolean literal", () => {
            const program = parseProgram("True");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Bool");
        });
    });
    (0, globals_1.describe)("Function Types", () => {
        (0, globals_1.it)("should infer identity function", () => {
            const program = parseProgram("fn x => x");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("(α) -> α");
        });
        (0, globals_1.it)("should infer function with multiple parameters", () => {
            const program = parseProgram("fn x y => x + y");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("(Int) -> (Int) -> Int");
        });
        (0, globals_1.it)("should infer nested function", () => {
            const program = parseProgram("fn x => fn y => x + y");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("(Int) -> (Int) -> Int");
        });
    });
    (0, globals_1.describe)("Let Polymorphism", () => {
        (0, globals_1.it)("should generalize identity function", () => {
            const program = parseProgram("id = fn x => x; id 42");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should allow polymorphic function to be used with different types", () => {
            const program = parseProgram('id = fn x => x; id 42; id "hello"');
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("String");
        });
        (0, globals_1.it)("should handle recursive definitions", () => {
            const program = parseProgram("fact = fn n => if n == 0 then 1 else n * (fact (n - 1)); fact 5");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
    });
    (0, globals_1.describe)("Function Application", () => {
        (0, globals_1.it)("should apply function to argument", () => {
            const program = parseProgram("(fn x => x + 1) 42");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should handle partial application", () => {
            const program = parseProgram("add = fn x y => x + y; add5 = add 5; add5 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should handle curried application", () => {
            const program = parseProgram("add = fn x y => x + y; add 2 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
    });
    (0, globals_1.describe)("Binary Operators", () => {
        (0, globals_1.it)("should infer arithmetic operations", () => {
            const program = parseProgram("2 + 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should infer comparison operations", () => {
            const program = parseProgram("2 < 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Bool");
        });
        (0, globals_1.it)("should infer equality operations", () => {
            const program = parseProgram("2 == 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Bool");
        });
    });
    (0, globals_1.describe)("If Expressions", () => {
        (0, globals_1.it)("should infer if expression with same types", () => {
            const program = parseProgram("if True then 1 else 2");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should handle if expression with different types", () => {
            const program = parseProgram('if True then 1 else "hello"');
            (0, globals_1.expect)(() => (0, __1.typeProgram)(program)).toThrow();
        });
    });
    (0, globals_1.describe)("Sequences", () => {
        (0, globals_1.it)("should handle semicolon sequences", () => {
            const program = parseProgram("1; 2; 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should handle sequences with definitions", () => {
            const program = parseProgram("x = 1; y = 2; x + y");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
    });
    (0, globals_1.describe)("Built-in Functions", () => {
        (0, globals_1.it)("should handle built-in arithmetic operators", () => {
            const program = parseProgram("2 + 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Int");
        });
        (0, globals_1.it)("should handle built-in comparison operators", () => {
            const program = parseProgram("2 == 3");
            const result = (0, __1.typeProgram)(program);
            (0, globals_1.expect)((0, helpers_1.typeToString)(result.type, result.state.substitution)).toBe("Bool");
        });
    });
    (0, globals_1.describe)("Type Environment", () => {
        (0, globals_1.it)("should initialize with built-ins", () => {
            const state = (0, __2.createTypeState)();
            const newState = (0, builtins_1.initializeBuiltins)(state);
            (0, globals_1.expect)(newState.environment.has("+")).toBe(true);
            (0, globals_1.expect)(newState.environment.has("-")).toBe(true);
            (0, globals_1.expect)(newState.environment.has("*")).toBe(true);
            (0, globals_1.expect)(newState.environment.has("/")).toBe(true);
            (0, globals_1.expect)(newState.environment.has("==")).toBe(true);
            (0, globals_1.expect)(newState.environment.has(";")).toBe(true);
        });
    });
    (0, globals_1.describe)("Error Cases", () => {
        (0, globals_1.it)("should reject undefined variables", () => {
            const program = parseProgram("undefined_var");
            (0, globals_1.expect)(() => (0, __1.typeProgram)(program)).toThrow("Undefined variable");
        });
        (0, globals_1.it)("should reject type mismatches in function application", () => {
            const program = parseProgram('(fn x => x + 1) "hello"');
            (0, globals_1.expect)(() => (0, __1.typeProgram)(program)).toThrow();
        });
        (0, globals_1.it)("should reject non-boolean conditions in if expressions", () => {
            const program = parseProgram("if 42 then 1 else 2");
            (0, globals_1.expect)(() => (0, __1.typeProgram)(program)).toThrow();
        });
    });
});
(0, globals_1.describe)("Constraint Propagation (Functional Typer)", () => {
    (0, globals_1.it)("should throw a type error when constraints are not satisfied in composition", () => {
        const program = parseProgram(`
      compose = fn f g => fn x => f (g x);
      safeHead = compose head;
      listId = fn x => x;
      result = safeHead listId [1, 2, 3]
    `);
        // This should work now since head is safe and returns Option
        const result = (0, __1.typeProgram)(program);
        (0, globals_1.expect)(result).toBeDefined();
    });
    (0, globals_1.it)("should allow composition when constraints are satisfied (functional typer)", () => {
        const program = parseProgram(`
      compose = fn f g => fn x => f (g x);
      safeHead = compose head;
      listId = fn x => x;
      result = safeHead listId [[1, 2, 3], [4, 5, 6]]
    `);
        const result = (0, __1.typeProgram)(program);
        const typeStr = (0, helpers_1.typeToString)(result.type, result.state.substitution);
        // head now returns Option List Int instead of List Int
        (0, globals_1.expect)(typeStr).toBe("Option List Int");
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZS9zcmMvdHlwZXIvX190ZXN0c19fL3R5cGVyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FBcUQ7QUFDckQsdUNBQW9DO0FBQ3BDLGdEQUE0QztBQUM1QywwQkFBaUM7QUFDakMsd0NBQTBDO0FBQzFDLDBCQUFxQztBQUNyQywwQ0FBaUQ7QUFFakQsbURBQW1EO0FBQ25ELE1BQU0sWUFBWSxHQUFHLENBQUMsTUFBYyxFQUFFLEVBQUU7SUFDdEMsTUFBTSxLQUFLLEdBQUcsSUFBSSxhQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDaEMsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2hDLE9BQU8sSUFBQSxjQUFLLEVBQUMsTUFBTSxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUFDO0FBRUYsSUFBQSxrQkFBUSxFQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxJQUFBLGtCQUFRLEVBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixJQUFBLFlBQUUsRUFBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7WUFDdEMsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25DLE1BQU0sTUFBTSxHQUFHLElBQUEsZUFBVyxFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BDLElBQUEsZ0JBQU0sRUFBQyxJQUFBLHNCQUFZLEVBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNFLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1lBQ3JDLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4QyxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDL0QsUUFBUSxDQUNULENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtZQUN0QyxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDckMsTUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsSUFBQSxnQkFBTSxFQUFDLElBQUEsc0JBQVksRUFBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDNUUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7UUFDOUIsSUFBQSxZQUFFLEVBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1lBQ3hDLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUMxQyxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDL0QsVUFBVSxDQUNYLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtZQUN4RCxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNoRCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDL0QsdUJBQXVCLENBQ3hCLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtZQUN0QyxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUN0RCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDL0QsdUJBQXVCLENBQ3hCLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxJQUFBLFlBQUUsRUFBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7WUFDN0MsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDdEQsTUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsSUFBQSxnQkFBTSxFQUFDLElBQUEsc0JBQVksRUFBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0UsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxtRUFBbUUsRUFBRSxHQUFHLEVBQUU7WUFDM0UsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7WUFDbEUsTUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsSUFBQSxnQkFBTSxFQUFDLElBQUEsc0JBQVksRUFBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQy9ELFFBQVEsQ0FDVCxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7WUFDN0MsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUMxQixpRUFBaUUsQ0FDbEUsQ0FBQztZQUNGLE1BQU0sTUFBTSxHQUFHLElBQUEsZUFBVyxFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BDLElBQUEsZ0JBQU0sRUFBQyxJQUFBLHNCQUFZLEVBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1FBQ3BDLElBQUEsWUFBRSxFQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtZQUMzQyxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsb0JBQW9CLENBQUMsQ0FBQztZQUNuRCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtZQUMzQyxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQzFCLDZDQUE2QyxDQUM5QyxDQUFDO1lBQ0YsTUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsSUFBQSxnQkFBTSxFQUFDLElBQUEsc0JBQVksRUFBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0UsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7WUFDM0MsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7WUFDL0QsTUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsSUFBQSxnQkFBTSxFQUFDLElBQUEsc0JBQVksRUFBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0UsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFDaEMsSUFBQSxZQUFFLEVBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO1lBQzVDLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN0QyxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdEMsTUFBTSxNQUFNLEdBQUcsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEMsSUFBQSxnQkFBTSxFQUFDLElBQUEsc0JBQVksRUFBQyxNQUFNLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDNUUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7WUFDMUMsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZDLE1BQU0sTUFBTSxHQUFHLElBQUEsZUFBVyxFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BDLElBQUEsZ0JBQU0sRUFBQyxJQUFBLHNCQUFZLEVBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzVFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLElBQUEsWUFBRSxFQUFDLDRDQUE0QyxFQUFFLEdBQUcsRUFBRTtZQUNwRCxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUN0RCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtZQUMxRCxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMsNkJBQTZCLENBQUMsQ0FBQztZQUM1RCxJQUFBLGdCQUFNLEVBQUMsR0FBRyxFQUFFLENBQUMsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsSUFBQSxZQUFFLEVBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4QyxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtZQUNsRCxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUNwRCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtRQUNsQyxJQUFBLFlBQUUsRUFBQyw2Q0FBNkMsRUFBRSxHQUFHLEVBQUU7WUFDckQsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sTUFBTSxHQUFHLElBQUEsZUFBVyxFQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BDLElBQUEsZ0JBQU0sRUFBQyxJQUFBLHNCQUFZLEVBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNFLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsNkNBQTZDLEVBQUUsR0FBRyxFQUFFO1lBQ3JELE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN2QyxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsSUFBQSxzQkFBWSxFQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxJQUFBLFlBQUUsRUFBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7WUFDMUMsTUFBTSxLQUFLLEdBQUcsSUFBQSxtQkFBZSxHQUFFLENBQUM7WUFDaEMsTUFBTSxRQUFRLEdBQUcsSUFBQSw2QkFBa0IsRUFBQyxLQUFLLENBQUMsQ0FBQztZQUUzQyxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pELElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqRCxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xELElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsSUFBQSxZQUFFLEVBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sT0FBTyxHQUFHLFlBQVksQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUM5QyxJQUFBLGdCQUFNLEVBQUMsR0FBRyxFQUFFLENBQUMsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztRQUNuRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRTtZQUMvRCxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMseUJBQXlCLENBQUMsQ0FBQztZQUN4RCxJQUFBLGdCQUFNLEVBQUMsR0FBRyxFQUFFLENBQUMsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLHdEQUF3RCxFQUFFLEdBQUcsRUFBRTtZQUNoRSxNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUNwRCxJQUFBLGdCQUFNLEVBQUMsR0FBRyxFQUFFLENBQUMsSUFBQSxlQUFXLEVBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMvQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFBLGtCQUFRLEVBQUMsMkNBQTJDLEVBQUUsR0FBRyxFQUFFO0lBQ3pELElBQUEsWUFBRSxFQUFDLDZFQUE2RSxFQUFFLEdBQUcsRUFBRTtRQUNyRixNQUFNLE9BQU8sR0FBRyxZQUFZLENBQUM7Ozs7O0tBSzVCLENBQUMsQ0FBQztRQUNILDZEQUE2RDtRQUM3RCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztRQUNwQyxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLFlBQUUsRUFBQyw0RUFBNEUsRUFBRSxHQUFHLEVBQUU7UUFDcEYsTUFBTSxPQUFPLEdBQUcsWUFBWSxDQUFDOzs7OztLQUs1QixDQUFDLENBQUM7UUFDSCxNQUFNLE1BQU0sR0FBRyxJQUFBLGVBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztRQUNwQyxNQUFNLE9BQU8sR0FBRyxJQUFBLHNCQUFZLEVBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3JFLHVEQUF1RDtRQUN2RCxJQUFBLGdCQUFNLEVBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvd29ya3NwYWNlL3NyYy90eXBlci9fX3Rlc3RzX18vdHlwZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCB9IGZyb20gXCJAamVzdC9nbG9iYWxzXCI7XG5pbXBvcnQgeyBMZXhlciB9IGZyb20gXCIuLi8uLi9sZXhlclwiO1xuaW1wb3J0IHsgcGFyc2UgfSBmcm9tIFwiLi4vLi4vcGFyc2VyL3BhcnNlclwiO1xuaW1wb3J0IHsgdHlwZVByb2dyYW0gfSBmcm9tICcuLic7XG5pbXBvcnQgeyB0eXBlVG9TdHJpbmcgfSBmcm9tICcuLi9oZWxwZXJzJztcbmltcG9ydCB7IGNyZWF0ZVR5cGVTdGF0ZSB9IGZyb20gJy4uJztcbmltcG9ydCB7IGluaXRpYWxpemVCdWlsdGlucyB9IGZyb20gJy4uL2J1aWx0aW5zJztcblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIHBhcnNlIGEgc3RyaW5nIGludG8gYSBwcm9ncmFtXG5jb25zdCBwYXJzZVByb2dyYW0gPSAoc291cmNlOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgbGV4ZXIgPSBuZXcgTGV4ZXIoc291cmNlKTtcbiAgY29uc3QgdG9rZW5zID0gbGV4ZXIudG9rZW5pemUoKTtcbiAgcmV0dXJuIHBhcnNlKHRva2Vucyk7XG59O1xuXG5kZXNjcmliZShcIkZ1bmN0aW9uYWwgVHlwZSBJbmZlcmVuY2VcIiwgKCkgPT4ge1xuICBkZXNjcmliZShcIkJhc2ljIFR5cGVzXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBpbmZlciBpbnRlZ2VyIGxpdGVyYWxcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZ3JhbSA9IHBhcnNlUHJvZ3JhbShcIjQyXCIpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcIkludFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGluZmVyIHN0cmluZyBsaXRlcmFsXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oJ1wiaGVsbG9cIicpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcbiAgICAgICAgXCJTdHJpbmdcIlxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGluZmVyIGJvb2xlYW4gbGl0ZXJhbFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKFwiVHJ1ZVwiKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHR5cGVQcm9ncmFtKHByb2dyYW0pO1xuICAgICAgZXhwZWN0KHR5cGVUb1N0cmluZyhyZXN1bHQudHlwZSwgcmVzdWx0LnN0YXRlLnN1YnN0aXR1dGlvbikpLnRvQmUoXCJCb29sXCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkZ1bmN0aW9uIFR5cGVzXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBpbmZlciBpZGVudGl0eSBmdW5jdGlvblwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKFwiZm4geCA9PiB4XCIpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcbiAgICAgICAgXCIozrEpIC0+IM6xXCJcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBpbmZlciBmdW5jdGlvbiB3aXRoIG11bHRpcGxlIHBhcmFtZXRlcnNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZ3JhbSA9IHBhcnNlUHJvZ3JhbShcImZuIHggeSA9PiB4ICsgeVwiKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHR5cGVQcm9ncmFtKHByb2dyYW0pO1xuICAgICAgZXhwZWN0KHR5cGVUb1N0cmluZyhyZXN1bHQudHlwZSwgcmVzdWx0LnN0YXRlLnN1YnN0aXR1dGlvbikpLnRvQmUoXG4gICAgICAgIFwiKEludCkgLT4gKEludCkgLT4gSW50XCJcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBpbmZlciBuZXN0ZWQgZnVuY3Rpb25cIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZ3JhbSA9IHBhcnNlUHJvZ3JhbShcImZuIHggPT4gZm4geSA9PiB4ICsgeVwiKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHR5cGVQcm9ncmFtKHByb2dyYW0pO1xuICAgICAgZXhwZWN0KHR5cGVUb1N0cmluZyhyZXN1bHQudHlwZSwgcmVzdWx0LnN0YXRlLnN1YnN0aXR1dGlvbikpLnRvQmUoXG4gICAgICAgIFwiKEludCkgLT4gKEludCkgLT4gSW50XCJcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiTGV0IFBvbHltb3JwaGlzbVwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgZ2VuZXJhbGl6ZSBpZGVudGl0eSBmdW5jdGlvblwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKFwiaWQgPSBmbiB4ID0+IHg7IGlkIDQyXCIpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcIkludFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGFsbG93IHBvbHltb3JwaGljIGZ1bmN0aW9uIHRvIGJlIHVzZWQgd2l0aCBkaWZmZXJlbnQgdHlwZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZ3JhbSA9IHBhcnNlUHJvZ3JhbSgnaWQgPSBmbiB4ID0+IHg7IGlkIDQyOyBpZCBcImhlbGxvXCInKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHR5cGVQcm9ncmFtKHByb2dyYW0pO1xuICAgICAgZXhwZWN0KHR5cGVUb1N0cmluZyhyZXN1bHQudHlwZSwgcmVzdWx0LnN0YXRlLnN1YnN0aXR1dGlvbikpLnRvQmUoXG4gICAgICAgIFwiU3RyaW5nXCJcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgcmVjdXJzaXZlIGRlZmluaXRpb25zXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXG4gICAgICAgIFwiZmFjdCA9IGZuIG4gPT4gaWYgbiA9PSAwIHRoZW4gMSBlbHNlIG4gKiAoZmFjdCAobiAtIDEpKTsgZmFjdCA1XCJcbiAgICAgICk7XG4gICAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIGV4cGVjdCh0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pKS50b0JlKFwiSW50XCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkZ1bmN0aW9uIEFwcGxpY2F0aW9uXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBhcHBseSBmdW5jdGlvbiB0byBhcmd1bWVudFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKFwiKGZuIHggPT4geCArIDEpIDQyXCIpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcIkludFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGhhbmRsZSBwYXJ0aWFsIGFwcGxpY2F0aW9uXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXG4gICAgICAgIFwiYWRkID0gZm4geCB5ID0+IHggKyB5OyBhZGQ1ID0gYWRkIDU7IGFkZDUgM1wiXG4gICAgICApO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcIkludFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGhhbmRsZSBjdXJyaWVkIGFwcGxpY2F0aW9uXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXCJhZGQgPSBmbiB4IHkgPT4geCArIHk7IGFkZCAyIDNcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIGV4cGVjdCh0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pKS50b0JlKFwiSW50XCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkJpbmFyeSBPcGVyYXRvcnNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGluZmVyIGFyaXRobWV0aWMgb3BlcmF0aW9uc1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKFwiMiArIDNcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIGV4cGVjdCh0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pKS50b0JlKFwiSW50XCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaW5mZXIgY29tcGFyaXNvbiBvcGVyYXRpb25zXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXCIyIDwgM1wiKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHR5cGVQcm9ncmFtKHByb2dyYW0pO1xuICAgICAgZXhwZWN0KHR5cGVUb1N0cmluZyhyZXN1bHQudHlwZSwgcmVzdWx0LnN0YXRlLnN1YnN0aXR1dGlvbikpLnRvQmUoXCJCb29sXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaW5mZXIgZXF1YWxpdHkgb3BlcmF0aW9uc1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKFwiMiA9PSAzXCIpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcIkJvb2xcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiSWYgRXhwcmVzc2lvbnNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGluZmVyIGlmIGV4cHJlc3Npb24gd2l0aCBzYW1lIHR5cGVzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXCJpZiBUcnVlIHRoZW4gMSBlbHNlIDJcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIGV4cGVjdCh0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pKS50b0JlKFwiSW50XCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIGlmIGV4cHJlc3Npb24gd2l0aCBkaWZmZXJlbnQgdHlwZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZ3JhbSA9IHBhcnNlUHJvZ3JhbSgnaWYgVHJ1ZSB0aGVuIDEgZWxzZSBcImhlbGxvXCInKTtcbiAgICAgIGV4cGVjdCgoKSA9PiB0eXBlUHJvZ3JhbShwcm9ncmFtKSkudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlNlcXVlbmNlc1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIHNlbWljb2xvbiBzZXF1ZW5jZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvZ3JhbSA9IHBhcnNlUHJvZ3JhbShcIjE7IDI7IDNcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIGV4cGVjdCh0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pKS50b0JlKFwiSW50XCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIHNlcXVlbmNlcyB3aXRoIGRlZmluaXRpb25zXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXCJ4ID0gMTsgeSA9IDI7IHggKyB5XCIpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gdHlwZVByb2dyYW0ocHJvZ3JhbSk7XG4gICAgICBleHBlY3QodHlwZVRvU3RyaW5nKHJlc3VsdC50eXBlLCByZXN1bHQuc3RhdGUuc3Vic3RpdHV0aW9uKSkudG9CZShcIkludFwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJCdWlsdC1pbiBGdW5jdGlvbnNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGhhbmRsZSBidWlsdC1pbiBhcml0aG1ldGljIG9wZXJhdG9yc1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKFwiMiArIDNcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIGV4cGVjdCh0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pKS50b0JlKFwiSW50XCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIGJ1aWx0LWluIGNvbXBhcmlzb24gb3BlcmF0b3JzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXCIyID09IDNcIik7XG4gICAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICAgIGV4cGVjdCh0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pKS50b0JlKFwiQm9vbFwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJUeXBlIEVudmlyb25tZW50XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBpbml0aWFsaXplIHdpdGggYnVpbHQtaW5zXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlID0gY3JlYXRlVHlwZVN0YXRlKCk7XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IGluaXRpYWxpemVCdWlsdGlucyhzdGF0ZSk7XG5cbiAgICAgIGV4cGVjdChuZXdTdGF0ZS5lbnZpcm9ubWVudC5oYXMoXCIrXCIpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG5ld1N0YXRlLmVudmlyb25tZW50LmhhcyhcIi1cIikpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobmV3U3RhdGUuZW52aXJvbm1lbnQuaGFzKFwiKlwiKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChuZXdTdGF0ZS5lbnZpcm9ubWVudC5oYXMoXCIvXCIpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG5ld1N0YXRlLmVudmlyb25tZW50LmhhcyhcIj09XCIpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG5ld1N0YXRlLmVudmlyb25tZW50LmhhcyhcIjtcIikpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiRXJyb3IgQ2FzZXNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJlamVjdCB1bmRlZmluZWQgdmFyaWFibGVzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXCJ1bmRlZmluZWRfdmFyXCIpO1xuICAgICAgZXhwZWN0KCgpID0+IHR5cGVQcm9ncmFtKHByb2dyYW0pKS50b1Rocm93KFwiVW5kZWZpbmVkIHZhcmlhYmxlXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVqZWN0IHR5cGUgbWlzbWF0Y2hlcyBpbiBmdW5jdGlvbiBhcHBsaWNhdGlvblwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKCcoZm4geCA9PiB4ICsgMSkgXCJoZWxsb1wiJyk7XG4gICAgICBleHBlY3QoKCkgPT4gdHlwZVByb2dyYW0ocHJvZ3JhbSkpLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJlamVjdCBub24tYm9vbGVhbiBjb25kaXRpb25zIGluIGlmIGV4cHJlc3Npb25zXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyYW0gPSBwYXJzZVByb2dyYW0oXCJpZiA0MiB0aGVuIDEgZWxzZSAyXCIpO1xuICAgICAgZXhwZWN0KCgpID0+IHR5cGVQcm9ncmFtKHByb2dyYW0pKS50b1Rocm93KCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKFwiQ29uc3RyYWludCBQcm9wYWdhdGlvbiAoRnVuY3Rpb25hbCBUeXBlcilcIiwgKCkgPT4ge1xuICBpdChcInNob3VsZCB0aHJvdyBhIHR5cGUgZXJyb3Igd2hlbiBjb25zdHJhaW50cyBhcmUgbm90IHNhdGlzZmllZCBpbiBjb21wb3NpdGlvblwiLCAoKSA9PiB7XG4gICAgY29uc3QgcHJvZ3JhbSA9IHBhcnNlUHJvZ3JhbShgXG4gICAgICBjb21wb3NlID0gZm4gZiBnID0+IGZuIHggPT4gZiAoZyB4KTtcbiAgICAgIHNhZmVIZWFkID0gY29tcG9zZSBoZWFkO1xuICAgICAgbGlzdElkID0gZm4geCA9PiB4O1xuICAgICAgcmVzdWx0ID0gc2FmZUhlYWQgbGlzdElkIFsxLCAyLCAzXVxuICAgIGApO1xuICAgIC8vIFRoaXMgc2hvdWxkIHdvcmsgbm93IHNpbmNlIGhlYWQgaXMgc2FmZSBhbmQgcmV0dXJucyBPcHRpb25cbiAgICBjb25zdCByZXN1bHQgPSB0eXBlUHJvZ3JhbShwcm9ncmFtKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBpdChcInNob3VsZCBhbGxvdyBjb21wb3NpdGlvbiB3aGVuIGNvbnN0cmFpbnRzIGFyZSBzYXRpc2ZpZWQgKGZ1bmN0aW9uYWwgdHlwZXIpXCIsICgpID0+IHtcbiAgICBjb25zdCBwcm9ncmFtID0gcGFyc2VQcm9ncmFtKGBcbiAgICAgIGNvbXBvc2UgPSBmbiBmIGcgPT4gZm4geCA9PiBmIChnIHgpO1xuICAgICAgc2FmZUhlYWQgPSBjb21wb3NlIGhlYWQ7XG4gICAgICBsaXN0SWQgPSBmbiB4ID0+IHg7XG4gICAgICByZXN1bHQgPSBzYWZlSGVhZCBsaXN0SWQgW1sxLCAyLCAzXSwgWzQsIDUsIDZdXVxuICAgIGApO1xuICAgIGNvbnN0IHJlc3VsdCA9IHR5cGVQcm9ncmFtKHByb2dyYW0pO1xuICAgIGNvbnN0IHR5cGVTdHIgPSB0eXBlVG9TdHJpbmcocmVzdWx0LnR5cGUsIHJlc3VsdC5zdGF0ZS5zdWJzdGl0dXRpb24pO1xuICAgIC8vIGhlYWQgbm93IHJldHVybnMgT3B0aW9uIExpc3QgSW50IGluc3RlYWQgb2YgTGlzdCBJbnRcbiAgICBleHBlY3QodHlwZVN0cikudG9CZShcIk9wdGlvbiBMaXN0IEludFwiKTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==