5a42a7cbf4ef12f79ba84af1df643f78
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getConstraintSignature = exports.resolveConstraintFunction = exports.addConstraintImplementation = exports.addConstraintDefinition = exports.createConstraintRegistry = exports.createPureTypeResult = exports.createTypeResult = exports.unionEffects = exports.singleEffect = exports.emptyEffects = void 0;
// Effect manipulation helpers
const emptyEffects = () => new Set();
exports.emptyEffects = emptyEffects;
const singleEffect = (effect) => new Set([effect]);
exports.singleEffect = singleEffect;
const unionEffects = (...effectSets) => {
    const result = new Set();
    for (const effects of effectSets) {
        for (const effect of effects) {
            result.add(effect);
        }
    }
    return result;
};
exports.unionEffects = unionEffects;
const createTypeResult = (type, effects, state) => ({
    type,
    effects,
    state,
});
exports.createTypeResult = createTypeResult;
const createPureTypeResult = (type, state) => ({
    type,
    effects: (0, exports.emptyEffects)(),
    state,
});
exports.createPureTypeResult = createPureTypeResult;
// Constraint registry helpers
const createConstraintRegistry = () => new Map();
exports.createConstraintRegistry = createConstraintRegistry;
const addConstraintDefinition = (registry, name, signature) => {
    registry.set(name, {
        signature,
        implementations: new Map()
    });
};
exports.addConstraintDefinition = addConstraintDefinition;
const addConstraintImplementation = (registry, constraintName, typeName, implementation) => {
    const constraint = registry.get(constraintName);
    if (!constraint) {
        return false; // Constraint not defined
    }
    constraint.implementations.set(typeName, implementation);
    return true;
};
exports.addConstraintImplementation = addConstraintImplementation;
const resolveConstraintFunction = (registry, constraintName, functionName, concreteType) => {
    const constraint = registry.get(constraintName);
    if (!constraint) {
        return null;
    }
    // Convert type to string for lookup
    const typeName = typeToString(concreteType);
    const impl = constraint.implementations.get(typeName);
    return impl?.functions.get(functionName) || null;
};
exports.resolveConstraintFunction = resolveConstraintFunction;
// Helper to get constraint signature
const getConstraintSignature = (registry, constraintName) => {
    return registry.get(constraintName)?.signature || null;
};
exports.getConstraintSignature = getConstraintSignature;
// Helper function to convert Type to string for registry keys
const typeToString = (type) => {
    switch (type.kind) {
        case "primitive":
            return type.name;
        case "variable":
            return type.name;
        case "list":
            return `List ${typeToString(type.element)}`;
        case "tuple":
            return `{${type.elements.map(typeToString).join(", ")}}`;
        case "record":
            const fields = Object.entries(type.fields)
                .map(([k, v]) => `${k}: ${typeToString(v)}`)
                .join(", ");
            return `{${fields}}`;
        case "function":
            const params = type.params.map(typeToString).join(" -> ");
            return `${params} -> ${typeToString(type.return)}`;
        case "union":
            return type.types.map(typeToString).join(" | ");
        case "variant":
            return type.args.length > 0
                ? `${type.name} ${type.args.map(typeToString).join(" ")}`
                : type.name;
        case "adt":
            return type.name;
        case "unit":
            return "Unit";
        case "unknown":
            return "?";
        default:
            return "Unknown";
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMxRCxPQUFPLEdBQUcsTUFBTSxPQUFPLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNwRCxLQUFLLE9BQU87WUFDWCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqRCxLQUFLLFNBQVM7WUFDYixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUM7Z0JBQzFCLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUN6RCxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztRQUNkLEtBQUssS0FBSztZQUNULE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztRQUNsQixLQUFLLE1BQU07WUFDVixPQUFPLE1BQU0sQ0FBQztRQUNmLEtBQUssU0FBUztZQUNiLE9BQU8sR0FBRyxDQUFDO1FBQ1o7WUFDQyxPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0FBQ0YsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2Uvc3JjL3R5cGVyL3R5cGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQ29uc3RyYWludCwgVHlwZSwgRWZmZWN0IH0gZnJvbSBcIi4uL2FzdFwiO1xuXG4vLyBBRFQgcmVnaXN0cnkgZm9yIHRyYWNraW5nIGRlZmluZWQgYWxnZWJyYWljIGRhdGEgdHlwZXNcbmV4cG9ydCB0eXBlIEFEVFJlZ2lzdHJ5ID0gTWFwPFxuXHRzdHJpbmcsXG5cdHtcblx0XHR0eXBlUGFyYW1zOiBzdHJpbmdbXTtcblx0XHRjb25zdHJ1Y3RvcnM6IE1hcDxzdHJpbmcsIFR5cGVbXT47IC8vIGNvbnN0cnVjdG9yIG5hbWUgLT4gYXJnIHR5cGVzXG5cdH1cbj47XG5cbi8vIENvbnN0cmFpbnQgc3lzdGVtIHR5cGVzIGZvciB0cmFpdCBzdXBwb3J0XG5leHBvcnQgdHlwZSBDb25zdHJhaW50U2lnbmF0dXJlID0ge1xuXHRuYW1lOiBzdHJpbmc7XG5cdHR5cGVQYXJhbTogc3RyaW5nO1xuXHRmdW5jdGlvbnM6IE1hcDxzdHJpbmcsIFR5cGU+OyAvLyBmdW5jdGlvbiBuYW1lIC0+IHR5cGUgc2lnbmF0dXJlXG59O1xuXG5leHBvcnQgdHlwZSBDb25zdHJhaW50SW1wbGVtZW50YXRpb24gPSB7XG5cdGZ1bmN0aW9uczogTWFwPHN0cmluZywgVHlwZVNjaGVtZT47IC8vIGZ1bmN0aW9uIG5hbWUgLT4gaW1wbGVtZW50YXRpb25cbn07XG5cbmV4cG9ydCB0eXBlIENvbnN0cmFpbnRSZWdpc3RyeSA9IE1hcDxzdHJpbmcsIHtcblx0c2lnbmF0dXJlOiBDb25zdHJhaW50U2lnbmF0dXJlO1xuXHRpbXBsZW1lbnRhdGlvbnM6IE1hcDxzdHJpbmcsIENvbnN0cmFpbnRJbXBsZW1lbnRhdGlvbj47IC8vIHR5cGUgbmFtZSAtPiBpbXBsZW1lbnRhdGlvblxufT47XG5cbi8vIFR5cGUgc2NoZW1lIGZvciBsZXQtcG9seW1vcnBoaXNtXG5leHBvcnQgdHlwZSBUeXBlU2NoZW1lID0ge1xuXHR0eXBlOiBUeXBlO1xuXHRxdWFudGlmaWVkVmFyczogc3RyaW5nW107XG5cdGVmZmVjdHM/OiBTZXQ8RWZmZWN0PjsgLy8gRWZmZWN0cyBmb3IgdmFsdWVzIHRoYXQgaGF2ZSBlZmZlY3RzXG59O1xuXG5leHBvcnQgdHlwZSBUeXBlRW52aXJvbm1lbnQgPSBNYXA8c3RyaW5nLCBUeXBlU2NoZW1lPiAmIHtcblx0Y29uc3RyYWludHM/OiBDb25zdHJhaW50UmVnaXN0cnk7XG59O1xuXG4vLyBGdW5jdGlvbmFsIHN0YXRlIGZvciB0eXBlIGluZmVyZW5jZVxuZXhwb3J0IHR5cGUgVHlwZVN0YXRlID0ge1xuXHRlbnZpcm9ubWVudDogVHlwZUVudmlyb25tZW50O1xuXHRzdWJzdGl0dXRpb246IE1hcDxzdHJpbmcsIFR5cGU+O1xuXHRjb3VudGVyOiBudW1iZXI7XG5cdGNvbnN0cmFpbnRzOiBDb25zdHJhaW50W107IC8vIFRyYWNrIGNvbnN0cmFpbnRzIGR1cmluZyBpbmZlcmVuY2Vcblx0YWR0UmVnaXN0cnk6IEFEVFJlZ2lzdHJ5OyAvLyBUcmFjayBBRFQgZGVmaW5pdGlvbnNcblx0YWNjZXNzb3JDYWNoZTogTWFwPHN0cmluZywgVHlwZT47IC8vIENhY2hlIGFjY2Vzc29yIHR5cGVzIGJ5IGZpZWxkIG5hbWVcblx0Y29uc3RyYWludFJlZ2lzdHJ5OiBDb25zdHJhaW50UmVnaXN0cnk7IC8vIFRyYWNrIGNvbnN0cmFpbnQgZGVmaW5pdGlvbnMgYW5kIGltcGxlbWVudGF0aW9uc1xufTtcblxuLy8gVHlwZSBpbmZlcmVuY2UgcmVzdWx0IHdpdGggc2VwYXJhdGVkIGVmZmVjdHNcbmV4cG9ydCB0eXBlIFR5cGVSZXN1bHQgPSB7XG5cdHR5cGU6IFR5cGU7XG5cdGVmZmVjdHM6IFNldDxFZmZlY3Q+O1xuXHRzdGF0ZTogVHlwZVN0YXRlO1xufTtcblxuLy8gRWZmZWN0IG1hbmlwdWxhdGlvbiBoZWxwZXJzXG5leHBvcnQgY29uc3QgZW1wdHlFZmZlY3RzID0gKCk6IFNldDxFZmZlY3Q+ID0+IG5ldyBTZXQoKTtcblxuZXhwb3J0IGNvbnN0IHNpbmdsZUVmZmVjdCA9IChlZmZlY3Q6IEVmZmVjdCk6IFNldDxFZmZlY3Q+ID0+IG5ldyBTZXQoW2VmZmVjdF0pO1xuXG5leHBvcnQgY29uc3QgdW5pb25FZmZlY3RzID0gKC4uLmVmZmVjdFNldHM6IFNldDxFZmZlY3Q+W10pOiBTZXQ8RWZmZWN0PiA9PiB7XG5cdGNvbnN0IHJlc3VsdCA9IG5ldyBTZXQ8RWZmZWN0PigpO1xuXHRmb3IgKGNvbnN0IGVmZmVjdHMgb2YgZWZmZWN0U2V0cykge1xuXHRcdGZvciAoY29uc3QgZWZmZWN0IG9mIGVmZmVjdHMpIHtcblx0XHRcdHJlc3VsdC5hZGQoZWZmZWN0KTtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVUeXBlUmVzdWx0ID0gKHR5cGU6IFR5cGUsIGVmZmVjdHM6IFNldDxFZmZlY3Q+LCBzdGF0ZTogVHlwZVN0YXRlKTogVHlwZVJlc3VsdCA9PiAoe1xuXHR0eXBlLFxuXHRlZmZlY3RzLFxuXHRzdGF0ZSxcbn0pO1xuXG5leHBvcnQgY29uc3QgY3JlYXRlUHVyZVR5cGVSZXN1bHQgPSAodHlwZTogVHlwZSwgc3RhdGU6IFR5cGVTdGF0ZSk6IFR5cGVSZXN1bHQgPT4gKHtcblx0dHlwZSxcblx0ZWZmZWN0czogZW1wdHlFZmZlY3RzKCksXG5cdHN0YXRlLFxufSk7XG5cbi8vIENvbnN0cmFpbnQgcmVnaXN0cnkgaGVscGVyc1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbnN0cmFpbnRSZWdpc3RyeSA9ICgpOiBDb25zdHJhaW50UmVnaXN0cnkgPT4gbmV3IE1hcCgpO1xuXG5leHBvcnQgY29uc3QgYWRkQ29uc3RyYWludERlZmluaXRpb24gPSAoXG5cdHJlZ2lzdHJ5OiBDb25zdHJhaW50UmVnaXN0cnksXG5cdG5hbWU6IHN0cmluZyxcblx0c2lnbmF0dXJlOiBDb25zdHJhaW50U2lnbmF0dXJlXG4pOiB2b2lkID0+IHtcblx0cmVnaXN0cnkuc2V0KG5hbWUsIHtcblx0XHRzaWduYXR1cmUsXG5cdFx0aW1wbGVtZW50YXRpb25zOiBuZXcgTWFwKClcblx0fSk7XG59O1xuXG5leHBvcnQgY29uc3QgYWRkQ29uc3RyYWludEltcGxlbWVudGF0aW9uID0gKFxuXHRyZWdpc3RyeTogQ29uc3RyYWludFJlZ2lzdHJ5LFxuXHRjb25zdHJhaW50TmFtZTogc3RyaW5nLFxuXHR0eXBlTmFtZTogc3RyaW5nLFxuXHRpbXBsZW1lbnRhdGlvbjogQ29uc3RyYWludEltcGxlbWVudGF0aW9uXG4pOiBib29sZWFuID0+IHtcblx0Y29uc3QgY29uc3RyYWludCA9IHJlZ2lzdHJ5LmdldChjb25zdHJhaW50TmFtZSk7XG5cdGlmICghY29uc3RyYWludCkge1xuXHRcdHJldHVybiBmYWxzZTsgLy8gQ29uc3RyYWludCBub3QgZGVmaW5lZFxuXHR9XG5cdGNvbnN0cmFpbnQuaW1wbGVtZW50YXRpb25zLnNldCh0eXBlTmFtZSwgaW1wbGVtZW50YXRpb24pO1xuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbmV4cG9ydCBjb25zdCByZXNvbHZlQ29uc3RyYWludEZ1bmN0aW9uID0gKFxuXHRyZWdpc3RyeTogQ29uc3RyYWludFJlZ2lzdHJ5LFxuXHRjb25zdHJhaW50TmFtZTogc3RyaW5nLFxuXHRmdW5jdGlvbk5hbWU6IHN0cmluZyxcblx0Y29uY3JldGVUeXBlOiBUeXBlXG4pOiBUeXBlU2NoZW1lIHwgbnVsbCA9PiB7XG5cdGNvbnN0IGNvbnN0cmFpbnQgPSByZWdpc3RyeS5nZXQoY29uc3RyYWludE5hbWUpO1xuXHRpZiAoIWNvbnN0cmFpbnQpIHtcblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXHRcblx0Ly8gQ29udmVydCB0eXBlIHRvIHN0cmluZyBmb3IgbG9va3VwXG5cdGNvbnN0IHR5cGVOYW1lID0gdHlwZVRvU3RyaW5nKGNvbmNyZXRlVHlwZSk7XG5cdGNvbnN0IGltcGwgPSBjb25zdHJhaW50LmltcGxlbWVudGF0aW9ucy5nZXQodHlwZU5hbWUpO1xuXHRyZXR1cm4gaW1wbD8uZnVuY3Rpb25zLmdldChmdW5jdGlvbk5hbWUpIHx8IG51bGw7XG59O1xuXG4vLyBIZWxwZXIgdG8gZ2V0IGNvbnN0cmFpbnQgc2lnbmF0dXJlXG5leHBvcnQgY29uc3QgZ2V0Q29uc3RyYWludFNpZ25hdHVyZSA9IChcblx0cmVnaXN0cnk6IENvbnN0cmFpbnRSZWdpc3RyeSxcblx0Y29uc3RyYWludE5hbWU6IHN0cmluZ1xuKTogQ29uc3RyYWludFNpZ25hdHVyZSB8IG51bGwgPT4ge1xuXHRyZXR1cm4gcmVnaXN0cnkuZ2V0KGNvbnN0cmFpbnROYW1lKT8uc2lnbmF0dXJlIHx8IG51bGw7XG59O1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBUeXBlIHRvIHN0cmluZyBmb3IgcmVnaXN0cnkga2V5c1xuY29uc3QgdHlwZVRvU3RyaW5nID0gKHR5cGU6IFR5cGUpOiBzdHJpbmcgPT4ge1xuXHRzd2l0Y2ggKHR5cGUua2luZCkge1xuXHRcdGNhc2UgXCJwcmltaXRpdmVcIjpcblx0XHRcdHJldHVybiB0eXBlLm5hbWU7XG5cdFx0Y2FzZSBcInZhcmlhYmxlXCI6XG5cdFx0XHRyZXR1cm4gdHlwZS5uYW1lO1xuXHRcdGNhc2UgXCJsaXN0XCI6XG5cdFx0XHRyZXR1cm4gYExpc3QgJHt0eXBlVG9TdHJpbmcodHlwZS5lbGVtZW50KX1gO1xuXHRcdGNhc2UgXCJ0dXBsZVwiOlxuXHRcdFx0cmV0dXJuIGB7JHt0eXBlLmVsZW1lbnRzLm1hcCh0eXBlVG9TdHJpbmcpLmpvaW4oXCIsIFwiKX19YDtcblx0XHRjYXNlIFwicmVjb3JkXCI6XG5cdFx0XHRjb25zdCBmaWVsZHMgPSBPYmplY3QuZW50cmllcyh0eXBlLmZpZWxkcylcblx0XHRcdFx0Lm1hcCgoW2ssIHZdKSA9PiBgJHtrfTogJHt0eXBlVG9TdHJpbmcodil9YClcblx0XHRcdFx0LmpvaW4oXCIsIFwiKTtcblx0XHRcdHJldHVybiBgeyR7ZmllbGRzfX1gO1xuXHRcdGNhc2UgXCJmdW5jdGlvblwiOlxuXHRcdFx0Y29uc3QgcGFyYW1zID0gdHlwZS5wYXJhbXMubWFwKHR5cGVUb1N0cmluZykuam9pbihcIiAtPiBcIik7XG5cdFx0XHRyZXR1cm4gYCR7cGFyYW1zfSAtPiAke3R5cGVUb1N0cmluZyh0eXBlLnJldHVybil9YDtcblx0XHRjYXNlIFwidW5pb25cIjpcblx0XHRcdHJldHVybiB0eXBlLnR5cGVzLm1hcCh0eXBlVG9TdHJpbmcpLmpvaW4oXCIgfCBcIik7XG5cdFx0Y2FzZSBcInZhcmlhbnRcIjpcblx0XHRcdHJldHVybiB0eXBlLmFyZ3MubGVuZ3RoID4gMCBcblx0XHRcdFx0PyBgJHt0eXBlLm5hbWV9ICR7dHlwZS5hcmdzLm1hcCh0eXBlVG9TdHJpbmcpLmpvaW4oXCIgXCIpfWBcblx0XHRcdFx0OiB0eXBlLm5hbWU7XG5cdFx0Y2FzZSBcImFkdFwiOlxuXHRcdFx0cmV0dXJuIHR5cGUubmFtZTtcblx0XHRjYXNlIFwidW5pdFwiOlxuXHRcdFx0cmV0dXJuIFwiVW5pdFwiO1xuXHRcdGNhc2UgXCJ1bmtub3duXCI6XG5cdFx0XHRyZXR1cm4gXCI/XCI7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdHJldHVybiBcIlVua25vd25cIjtcblx0fVxufTtcbiJdLCJ2ZXJzaW9uIjozfQ==