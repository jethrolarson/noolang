b5b33b7fa3bef146bab61440132f897a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lexer_1 = require("../src/lexer");
const parser_1 = require("../src/parser/parser");
const evaluator_1 = require("../src/evaluator");
describe("File-relative imports", () => {
    const mockFs = {
        readFileSync: (filePath, encoding) => {
            if (typeof filePath === "string" && filePath.includes("stdlib.noo")) {
                return "# Noolang Standard Library\n# This file defines the global default environment\n";
            }
            if (typeof filePath === "string" &&
                filePath.includes("math_functions.noo")) {
                return "{ @add fn x y => x + y, @multiply fn x y => x * y }";
            }
            throw new Error(`File not found: ${filePath}`);
        },
        existsSync: (filePath) => {
            if (typeof filePath === "string" && filePath.includes("stdlib.noo")) {
                return true;
            }
            if (typeof filePath === "string" &&
                filePath.includes("math_functions.noo")) {
                return true;
            }
            return false;
        },
    };
    test("should import from same directory", () => {
        const testCode = `
      math = import "math_functions";
      (@add math) 2 3
    `;
        const lexer = new lexer_1.Lexer(testCode);
        const tokens = lexer.tokenize();
        const program = (0, parser_1.parse)(tokens);
        const evaluator = new evaluator_1.Evaluator({ fs: mockFs });
        const result = evaluator.evaluateProgram(program, "/test/dir/test_file.noo");
        expect(result.finalResult).toEqual({ tag: "number", value: 5 });
    });
    test("should import from parent directory", () => {
        const testCode = `
      math = import "../math_functions";
      (@add math) 10 20
    `;
        const lexer = new lexer_1.Lexer(testCode);
        const tokens = lexer.tokenize();
        const program = (0, parser_1.parse)(tokens);
        const evaluator = new evaluator_1.Evaluator({ fs: mockFs });
        const result = evaluator.evaluateProgram(program, "/test/dir/subdir/test_file.noo");
        expect(result.finalResult).toEqual({ tag: "number", value: 30 });
    });
    test("should handle absolute paths", () => {
        const testCode = `
      math = import "/absolute/path/math_functions";
      (@add math) 5 10
    `;
        const lexer = new lexer_1.Lexer(testCode);
        const tokens = lexer.tokenize();
        const program = (0, parser_1.parse)(tokens);
        const evaluator = new evaluator_1.Evaluator({ fs: mockFs });
        const result = evaluator.evaluateProgram(program, "/test/dir/test_file.noo");
        expect(result.finalResult).toEqual({ tag: "number", value: 15 });
    });
    test("should fall back to current working directory when no file path provided", () => {
        const testCode = `
      math = import "math_functions";
      (@add math) 3 7
    `;
        const lexer = new lexer_1.Lexer(testCode);
        const tokens = lexer.tokenize();
        const program = (0, parser_1.parse)(tokens);
        const evaluator = new evaluator_1.Evaluator({ fs: mockFs });
        const result = evaluator.evaluateProgram(program); // No file path
        expect(result.finalResult).toEqual({ tag: "number", value: 10 });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxDQUFDO0lBQ2xFLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL3dvcmtzcGFjZS90ZXN0L2ltcG9ydF9yZWxhdGl2ZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExleGVyIH0gZnJvbSBcIi4uL3NyYy9sZXhlclwiO1xuaW1wb3J0IHsgcGFyc2UgfSBmcm9tIFwiLi4vc3JjL3BhcnNlci9wYXJzZXJcIjtcbmltcG9ydCB7IEV2YWx1YXRvciB9IGZyb20gXCIuLi9zcmMvZXZhbHVhdG9yXCI7XG5cbmRlc2NyaWJlKFwiRmlsZS1yZWxhdGl2ZSBpbXBvcnRzXCIsICgpID0+IHtcblx0Y29uc3QgbW9ja0ZzID0ge1xuXHRcdHJlYWRGaWxlU3luYzogKGZpbGVQYXRoOiB1bmtub3duLCBlbmNvZGluZzogc3RyaW5nKSA9PiB7XG5cdFx0XHRpZiAodHlwZW9mIGZpbGVQYXRoID09PSBcInN0cmluZ1wiICYmIGZpbGVQYXRoLmluY2x1ZGVzKFwic3RkbGliLm5vb1wiKSkge1xuXHRcdFx0XHRyZXR1cm4gXCIjIE5vb2xhbmcgU3RhbmRhcmQgTGlicmFyeVxcbiMgVGhpcyBmaWxlIGRlZmluZXMgdGhlIGdsb2JhbCBkZWZhdWx0IGVudmlyb25tZW50XFxuXCI7XG5cdFx0XHR9XG5cdFx0XHRpZiAoXG5cdFx0XHRcdHR5cGVvZiBmaWxlUGF0aCA9PT0gXCJzdHJpbmdcIiAmJlxuXHRcdFx0XHRmaWxlUGF0aC5pbmNsdWRlcyhcIm1hdGhfZnVuY3Rpb25zLm5vb1wiKVxuXHRcdFx0KSB7XG5cdFx0XHRcdHJldHVybiBcInsgQGFkZCBmbiB4IHkgPT4geCArIHksIEBtdWx0aXBseSBmbiB4IHkgPT4geCAqIHkgfVwiO1xuXHRcdFx0fVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBGaWxlIG5vdCBmb3VuZDogJHtmaWxlUGF0aH1gKTtcblx0XHR9LFxuXHRcdGV4aXN0c1N5bmM6IChmaWxlUGF0aDogdW5rbm93bikgPT4ge1xuXHRcdFx0aWYgKHR5cGVvZiBmaWxlUGF0aCA9PT0gXCJzdHJpbmdcIiAmJiBmaWxlUGF0aC5pbmNsdWRlcyhcInN0ZGxpYi5ub29cIikpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0XHRpZiAoXG5cdFx0XHRcdHR5cGVvZiBmaWxlUGF0aCA9PT0gXCJzdHJpbmdcIiAmJlxuXHRcdFx0XHRmaWxlUGF0aC5pbmNsdWRlcyhcIm1hdGhfZnVuY3Rpb25zLm5vb1wiKVxuXHRcdFx0KSB7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH0sXG5cdH07XG5cblx0dGVzdChcInNob3VsZCBpbXBvcnQgZnJvbSBzYW1lIGRpcmVjdG9yeVwiLCAoKSA9PiB7XG5cdFx0Y29uc3QgdGVzdENvZGUgPSBgXG4gICAgICBtYXRoID0gaW1wb3J0IFwibWF0aF9mdW5jdGlvbnNcIjtcbiAgICAgIChAYWRkIG1hdGgpIDIgM1xuICAgIGA7XG5cdFx0Y29uc3QgbGV4ZXIgPSBuZXcgTGV4ZXIodGVzdENvZGUpO1xuXHRcdGNvbnN0IHRva2VucyA9IGxleGVyLnRva2VuaXplKCk7XG5cdFx0Y29uc3QgcHJvZ3JhbSA9IHBhcnNlKHRva2Vucyk7XG5cdFx0Y29uc3QgZXZhbHVhdG9yID0gbmV3IEV2YWx1YXRvcih7IGZzOiBtb2NrRnMgYXMgYW55IH0pO1xuXHRcdGNvbnN0IHJlc3VsdCA9IGV2YWx1YXRvci5ldmFsdWF0ZVByb2dyYW0oXG5cdFx0XHRwcm9ncmFtLFxuXHRcdFx0XCIvdGVzdC9kaXIvdGVzdF9maWxlLm5vb1wiLFxuXHRcdCk7XG5cdFx0ZXhwZWN0KHJlc3VsdC5maW5hbFJlc3VsdCkudG9FcXVhbCh7IHRhZzogXCJudW1iZXJcIiwgdmFsdWU6IDUgfSk7XG5cdH0pO1xuXG5cdHRlc3QoXCJzaG91bGQgaW1wb3J0IGZyb20gcGFyZW50IGRpcmVjdG9yeVwiLCAoKSA9PiB7XG5cdFx0Y29uc3QgdGVzdENvZGUgPSBgXG4gICAgICBtYXRoID0gaW1wb3J0IFwiLi4vbWF0aF9mdW5jdGlvbnNcIjtcbiAgICAgIChAYWRkIG1hdGgpIDEwIDIwXG4gICAgYDtcblx0XHRjb25zdCBsZXhlciA9IG5ldyBMZXhlcih0ZXN0Q29kZSk7XG5cdFx0Y29uc3QgdG9rZW5zID0gbGV4ZXIudG9rZW5pemUoKTtcblx0XHRjb25zdCBwcm9ncmFtID0gcGFyc2UodG9rZW5zKTtcblx0XHRjb25zdCBldmFsdWF0b3IgPSBuZXcgRXZhbHVhdG9yKHsgZnM6IG1vY2tGcyBhcyBhbnkgfSk7XG5cdFx0Y29uc3QgcmVzdWx0ID0gZXZhbHVhdG9yLmV2YWx1YXRlUHJvZ3JhbShcblx0XHRcdHByb2dyYW0sXG5cdFx0XHRcIi90ZXN0L2Rpci9zdWJkaXIvdGVzdF9maWxlLm5vb1wiLFxuXHRcdCk7XG5cdFx0ZXhwZWN0KHJlc3VsdC5maW5hbFJlc3VsdCkudG9FcXVhbCh7IHRhZzogXCJudW1iZXJcIiwgdmFsdWU6IDMwIH0pO1xuXHR9KTtcblxuXHR0ZXN0KFwic2hvdWxkIGhhbmRsZSBhYnNvbHV0ZSBwYXRoc1wiLCAoKSA9PiB7XG5cdFx0Y29uc3QgdGVzdENvZGUgPSBgXG4gICAgICBtYXRoID0gaW1wb3J0IFwiL2Fic29sdXRlL3BhdGgvbWF0aF9mdW5jdGlvbnNcIjtcbiAgICAgIChAYWRkIG1hdGgpIDUgMTBcbiAgICBgO1xuXHRcdGNvbnN0IGxleGVyID0gbmV3IExleGVyKHRlc3RDb2RlKTtcblx0XHRjb25zdCB0b2tlbnMgPSBsZXhlci50b2tlbml6ZSgpO1xuXHRcdGNvbnN0IHByb2dyYW0gPSBwYXJzZSh0b2tlbnMpO1xuXHRcdGNvbnN0IGV2YWx1YXRvciA9IG5ldyBFdmFsdWF0b3IoeyBmczogbW9ja0ZzIGFzIGFueSB9KTtcblx0XHRjb25zdCByZXN1bHQgPSBldmFsdWF0b3IuZXZhbHVhdGVQcm9ncmFtKFxuXHRcdFx0cHJvZ3JhbSxcblx0XHRcdFwiL3Rlc3QvZGlyL3Rlc3RfZmlsZS5ub29cIixcblx0XHQpO1xuXHRcdGV4cGVjdChyZXN1bHQuZmluYWxSZXN1bHQpLnRvRXF1YWwoeyB0YWc6IFwibnVtYmVyXCIsIHZhbHVlOiAxNSB9KTtcblx0fSk7XG5cblx0dGVzdChcInNob3VsZCBmYWxsIGJhY2sgdG8gY3VycmVudCB3b3JraW5nIGRpcmVjdG9yeSB3aGVuIG5vIGZpbGUgcGF0aCBwcm92aWRlZFwiLCAoKSA9PiB7XG5cdFx0Y29uc3QgdGVzdENvZGUgPSBgXG4gICAgICBtYXRoID0gaW1wb3J0IFwibWF0aF9mdW5jdGlvbnNcIjtcbiAgICAgIChAYWRkIG1hdGgpIDMgN1xuICAgIGA7XG5cdFx0Y29uc3QgbGV4ZXIgPSBuZXcgTGV4ZXIodGVzdENvZGUpO1xuXHRcdGNvbnN0IHRva2VucyA9IGxleGVyLnRva2VuaXplKCk7XG5cdFx0Y29uc3QgcHJvZ3JhbSA9IHBhcnNlKHRva2Vucyk7XG5cdFx0Y29uc3QgZXZhbHVhdG9yID0gbmV3IEV2YWx1YXRvcih7IGZzOiBtb2NrRnMgYXMgYW55IH0pO1xuXHRcdGNvbnN0IHJlc3VsdCA9IGV2YWx1YXRvci5ldmFsdWF0ZVByb2dyYW0ocHJvZ3JhbSk7IC8vIE5vIGZpbGUgcGF0aFxuXHRcdGV4cGVjdChyZXN1bHQuZmluYWxSZXN1bHQpLnRvRXF1YWwoeyB0YWc6IFwibnVtYmVyXCIsIHZhbHVlOiAxMCB9KTtcblx0fSk7XG59KTsgIl0sInZlcnNpb24iOjN9