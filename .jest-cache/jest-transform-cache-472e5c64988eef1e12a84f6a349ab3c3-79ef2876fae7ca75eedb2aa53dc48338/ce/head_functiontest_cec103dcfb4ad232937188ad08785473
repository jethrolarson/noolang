03344a37fd78f4bf20ee827d2a9dfa63
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lexer_1 = require("../src/lexer");
const parser_1 = require("../src/parser/parser");
const typer_1 = require("../src/typer");
const evaluator_1 = require("../src/evaluator");
function unwrapValue(val) {
    if (val === null)
        return null;
    if (typeof val !== "object")
        return val;
    switch (val.tag) {
        case "number":
            return val.value;
        case "string":
            return val.value;
        case "constructor":
            if (val.name === "True")
                return true;
            if (val.name === "False")
                return false;
            return { name: val.name, args: val.args.map(unwrapValue) };
        case "list":
            return val.values.map(unwrapValue);
        case "tuple":
            return val.values.map(unwrapValue);
        case "record": {
            const obj = {};
            for (const k in val.fields)
                obj[k] = unwrapValue(val.fields[k]);
            return obj;
        }
        default:
            return val;
    }
}
describe("Head Function Tests", () => {
    let evaluator;
    beforeEach(() => {
        evaluator = new evaluator_1.Evaluator();
    });
    const runCode = (code) => {
        const lexer = new lexer_1.Lexer(code);
        const tokens = lexer.tokenize();
        const ast = (0, parser_1.parse)(tokens);
        const decoratedResult = (0, typer_1.typeAndDecorate)(ast);
        return evaluator.evaluateProgram(decoratedResult.program);
    };
    test("should work with integer lists", () => {
        const code = `
      numbers = [1, 2, 3, 4, 5];
      head numbers
    `;
        const result = runCode(code);
        // head now returns Some 1, so we check for the constructor
        const finalResult = unwrapValue(result.finalResult);
        expect(finalResult.name).toBe("Some");
        expect(unwrapValue(finalResult.args[0])).toBe(1);
    });
    test("should work with string lists", () => {
        const code = `
      strings = ["hello", "world", "noolang"];
      head strings
    `;
        const result = runCode(code);
        // head now returns Some "hello"
        const finalResult = unwrapValue(result.finalResult);
        expect(finalResult.name).toBe("Some");
        expect(unwrapValue(finalResult.args[0])).toBe("hello");
    });
    test("should work with boolean lists", () => {
        const code = `
      bools = [True, False, True];
      head bools
    `;
        const result = runCode(code);
        // head now returns Some True
        const finalResult = unwrapValue(result.finalResult);
        expect(finalResult.name).toBe("Some");
        const boolResult = finalResult.args[0];
        // The Bool constructor gets unwrapped to JavaScript boolean
        expect(boolResult).toBe(true);
    });
    test("should work with nested lists", () => {
        const code = `
      nested = [[1, 2], [3, 4]];
      head nested
    `;
        const result = runCode(code);
        // head now returns Some [1, 2]
        const finalResult = unwrapValue(result.finalResult);
        expect(finalResult.name).toBe("Some");
        expect(unwrapValue(finalResult.args[0])).toEqual([1, 2]);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZS90ZXN0L2hlYWRfZnVuY3Rpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHdDQUFxQztBQUNyQyxpREFBNkM7QUFDN0Msd0NBQStDO0FBQy9DLGdEQUF5RDtBQUV6RCxTQUFTLFdBQVcsQ0FBQyxHQUFVO0lBQzdCLElBQUksR0FBRyxLQUFLLElBQUk7UUFBRSxPQUFPLElBQUksQ0FBQztJQUM5QixJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVE7UUFBRSxPQUFPLEdBQUcsQ0FBQztJQUN4QyxRQUFRLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNoQixLQUFLLFFBQVE7WUFDWCxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUM7UUFDbkIsS0FBSyxRQUFRO1lBQ1gsT0FBTyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQ25CLEtBQUssYUFBYTtZQUNoQixJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssTUFBTTtnQkFBRSxPQUFPLElBQUksQ0FBQztZQUNyQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssT0FBTztnQkFBRSxPQUFPLEtBQUssQ0FBQztZQUN2QyxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7UUFDN0QsS0FBSyxNQUFNO1lBQ1QsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyQyxLQUFLLE9BQU87WUFDVixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNkLE1BQU0sR0FBRyxHQUFRLEVBQUUsQ0FBQztZQUNwQixLQUFLLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxNQUFNO2dCQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hFLE9BQU8sR0FBRyxDQUFDO1FBQ2IsQ0FBQztRQUNEO1lBQ0UsT0FBTyxHQUFHLENBQUM7SUFDZixDQUFDO0FBQ0gsQ0FBQztBQUVELFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7SUFDbkMsSUFBSSxTQUFvQixDQUFDO0lBRXpCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxTQUFTLEdBQUcsSUFBSSxxQkFBUyxFQUFFLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLE9BQU8sR0FBRyxDQUFDLElBQVksRUFBRSxFQUFFO1FBQy9CLE1BQU0sS0FBSyxHQUFHLElBQUksYUFBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlCLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNoQyxNQUFNLEdBQUcsR0FBRyxJQUFBLGNBQUssRUFBQyxNQUFNLENBQUMsQ0FBQztRQUMxQixNQUFNLGVBQWUsR0FBRyxJQUFBLHVCQUFlLEVBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0MsT0FBTyxTQUFTLENBQUMsZUFBZSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUM7SUFFRixJQUFJLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO1FBQzFDLE1BQU0sSUFBSSxHQUFHOzs7S0FHWixDQUFDO1FBQ0YsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdCLDJEQUEyRDtRQUMzRCxNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25ELENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtRQUN6QyxNQUFNLElBQUksR0FBRzs7O0tBR1osQ0FBQztRQUNGLE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QixnQ0FBZ0M7UUFDaEMsTUFBTSxXQUFXLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNwRCxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN0QyxNQUFNLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN6RCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7UUFDMUMsTUFBTSxJQUFJLEdBQUc7OztLQUdaLENBQUM7UUFDRixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsNkJBQTZCO1FBQzdCLE1BQU0sV0FBVyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDcEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2Qyw0REFBNEQ7UUFDNUQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDekMsTUFBTSxJQUFJLEdBQUc7OztLQUdaLENBQUM7UUFDRixNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsK0JBQStCO1FBQy9CLE1BQU0sV0FBVyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDcEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMzRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi93b3Jrc3BhY2UvdGVzdC9oZWFkX2Z1bmN0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTGV4ZXIgfSBmcm9tIFwiLi4vc3JjL2xleGVyXCI7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gXCIuLi9zcmMvcGFyc2VyL3BhcnNlclwiO1xuaW1wb3J0IHsgdHlwZUFuZERlY29yYXRlIH0gZnJvbSBcIi4uL3NyYy90eXBlclwiO1xuaW1wb3J0IHsgRXZhbHVhdG9yLCB0eXBlIFZhbHVlIH0gZnJvbSBcIi4uL3NyYy9ldmFsdWF0b3JcIjtcblxuZnVuY3Rpb24gdW53cmFwVmFsdWUodmFsOiBWYWx1ZSk6IGFueSB7XG4gIGlmICh2YWwgPT09IG51bGwpIHJldHVybiBudWxsO1xuICBpZiAodHlwZW9mIHZhbCAhPT0gXCJvYmplY3RcIikgcmV0dXJuIHZhbDtcbiAgc3dpdGNoICh2YWwudGFnKSB7XG4gICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgcmV0dXJuIHZhbC52YWx1ZTtcbiAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICByZXR1cm4gdmFsLnZhbHVlO1xuICAgIGNhc2UgXCJjb25zdHJ1Y3RvclwiOlxuICAgICAgaWYgKHZhbC5uYW1lID09PSBcIlRydWVcIikgcmV0dXJuIHRydWU7XG4gICAgICBpZiAodmFsLm5hbWUgPT09IFwiRmFsc2VcIikgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHsgbmFtZTogdmFsLm5hbWUsIGFyZ3M6IHZhbC5hcmdzLm1hcCh1bndyYXBWYWx1ZSkgfTtcbiAgICBjYXNlIFwibGlzdFwiOlxuICAgICAgcmV0dXJuIHZhbC52YWx1ZXMubWFwKHVud3JhcFZhbHVlKTtcbiAgICBjYXNlIFwidHVwbGVcIjpcbiAgICAgIHJldHVybiB2YWwudmFsdWVzLm1hcCh1bndyYXBWYWx1ZSk7XG4gICAgY2FzZSBcInJlY29yZFwiOiB7XG4gICAgICBjb25zdCBvYmo6IGFueSA9IHt9O1xuICAgICAgZm9yIChjb25zdCBrIGluIHZhbC5maWVsZHMpIG9ialtrXSA9IHVud3JhcFZhbHVlKHZhbC5maWVsZHNba10pO1xuICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB2YWw7XG4gIH1cbn1cblxuZGVzY3JpYmUoXCJIZWFkIEZ1bmN0aW9uIFRlc3RzXCIsICgpID0+IHtcbiAgbGV0IGV2YWx1YXRvcjogRXZhbHVhdG9yO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGV2YWx1YXRvciA9IG5ldyBFdmFsdWF0b3IoKTtcbiAgfSk7XG5cbiAgY29uc3QgcnVuQ29kZSA9IChjb2RlOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBsZXhlciA9IG5ldyBMZXhlcihjb2RlKTtcbiAgICBjb25zdCB0b2tlbnMgPSBsZXhlci50b2tlbml6ZSgpO1xuICAgIGNvbnN0IGFzdCA9IHBhcnNlKHRva2Vucyk7XG4gICAgY29uc3QgZGVjb3JhdGVkUmVzdWx0ID0gdHlwZUFuZERlY29yYXRlKGFzdCk7XG4gICAgcmV0dXJuIGV2YWx1YXRvci5ldmFsdWF0ZVByb2dyYW0oZGVjb3JhdGVkUmVzdWx0LnByb2dyYW0pO1xuICB9O1xuXG4gIHRlc3QoXCJzaG91bGQgd29yayB3aXRoIGludGVnZXIgbGlzdHNcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGNvZGUgPSBgXG4gICAgICBudW1iZXJzID0gWzEsIDIsIDMsIDQsIDVdO1xuICAgICAgaGVhZCBudW1iZXJzXG4gICAgYDtcbiAgICBjb25zdCByZXN1bHQgPSBydW5Db2RlKGNvZGUpO1xuICAgIC8vIGhlYWQgbm93IHJldHVybnMgU29tZSAxLCBzbyB3ZSBjaGVjayBmb3IgdGhlIGNvbnN0cnVjdG9yXG4gICAgY29uc3QgZmluYWxSZXN1bHQgPSB1bndyYXBWYWx1ZShyZXN1bHQuZmluYWxSZXN1bHQpO1xuICAgIGV4cGVjdChmaW5hbFJlc3VsdC5uYW1lKS50b0JlKFwiU29tZVwiKTtcbiAgICBleHBlY3QodW53cmFwVmFsdWUoZmluYWxSZXN1bHQuYXJnc1swXSkpLnRvQmUoMSk7XG4gIH0pO1xuXG4gIHRlc3QoXCJzaG91bGQgd29yayB3aXRoIHN0cmluZyBsaXN0c1wiLCAoKSA9PiB7XG4gICAgY29uc3QgY29kZSA9IGBcbiAgICAgIHN0cmluZ3MgPSBbXCJoZWxsb1wiLCBcIndvcmxkXCIsIFwibm9vbGFuZ1wiXTtcbiAgICAgIGhlYWQgc3RyaW5nc1xuICAgIGA7XG4gICAgY29uc3QgcmVzdWx0ID0gcnVuQ29kZShjb2RlKTtcbiAgICAvLyBoZWFkIG5vdyByZXR1cm5zIFNvbWUgXCJoZWxsb1wiXG4gICAgY29uc3QgZmluYWxSZXN1bHQgPSB1bndyYXBWYWx1ZShyZXN1bHQuZmluYWxSZXN1bHQpO1xuICAgIGV4cGVjdChmaW5hbFJlc3VsdC5uYW1lKS50b0JlKFwiU29tZVwiKTtcbiAgICBleHBlY3QodW53cmFwVmFsdWUoZmluYWxSZXN1bHQuYXJnc1swXSkpLnRvQmUoXCJoZWxsb1wiKTtcbiAgfSk7XG5cbiAgdGVzdChcInNob3VsZCB3b3JrIHdpdGggYm9vbGVhbiBsaXN0c1wiLCAoKSA9PiB7XG4gICAgY29uc3QgY29kZSA9IGBcbiAgICAgIGJvb2xzID0gW1RydWUsIEZhbHNlLCBUcnVlXTtcbiAgICAgIGhlYWQgYm9vbHNcbiAgICBgO1xuICAgIGNvbnN0IHJlc3VsdCA9IHJ1bkNvZGUoY29kZSk7XG4gICAgLy8gaGVhZCBub3cgcmV0dXJucyBTb21lIFRydWVcbiAgICBjb25zdCBmaW5hbFJlc3VsdCA9IHVud3JhcFZhbHVlKHJlc3VsdC5maW5hbFJlc3VsdCk7XG4gICAgZXhwZWN0KGZpbmFsUmVzdWx0Lm5hbWUpLnRvQmUoXCJTb21lXCIpO1xuICAgIGNvbnN0IGJvb2xSZXN1bHQgPSBmaW5hbFJlc3VsdC5hcmdzWzBdO1xuICAgIC8vIFRoZSBCb29sIGNvbnN0cnVjdG9yIGdldHMgdW53cmFwcGVkIHRvIEphdmFTY3JpcHQgYm9vbGVhblxuICAgIGV4cGVjdChib29sUmVzdWx0KS50b0JlKHRydWUpO1xuICB9KTtcblxuICB0ZXN0KFwic2hvdWxkIHdvcmsgd2l0aCBuZXN0ZWQgbGlzdHNcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGNvZGUgPSBgXG4gICAgICBuZXN0ZWQgPSBbWzEsIDJdLCBbMywgNF1dO1xuICAgICAgaGVhZCBuZXN0ZWRcbiAgICBgO1xuICAgIGNvbnN0IHJlc3VsdCA9IHJ1bkNvZGUoY29kZSk7XG4gICAgLy8gaGVhZCBub3cgcmV0dXJucyBTb21lIFsxLCAyXVxuICAgIGNvbnN0IGZpbmFsUmVzdWx0ID0gdW53cmFwVmFsdWUocmVzdWx0LmZpbmFsUmVzdWx0KTtcbiAgICBleHBlY3QoZmluYWxSZXN1bHQubmFtZSkudG9CZShcIlNvbWVcIik7XG4gICAgZXhwZWN0KHVud3JhcFZhbHVlKGZpbmFsUmVzdWx0LmFyZ3NbMF0pKS50b0VxdWFsKFsxLCAyXSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=